{
  "$schema": "https://schema.management.azure.com/schemas/2018-05-01/subscriptionDeploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
  },
  "variables": {
    "role_VmContributor": "/providers/Microsoft.Authorization/roleDefinitions/9980e02c-c2be-4d73-94e8-173b1dc7cf3c",
    "role_automationContributor": "/providers/Microsoft.Authorization/roleDefinitions/f353d9bd-d4a6-484e-a77a-8050b599b867",
    "role_arcMachineAdmin": "/providers/Microsoft.Authorization/roleDefinitions/cd570a14-e51a-42ad-bac8-bafd67325302",
    "role_monitoringContributor": "/providers/Microsoft.Authorization/roleDefinitions/749f88d5-cbae-40b8-bcfc-e573ddc772fa",
    "role_wacAdmin": "/providers/Microsoft.Authorization/roleDefinitions/a6333a3e-0164-44c3-b281-7a577aff287f",
    "role_policyContributor": "/providers/Microsoft.Authorization/roleDefinitions/36243c78-bf99-498c-9df9-86d9f8d28608",
    "seed": "AzureAutomanage"
  },
  "resources": [
    {
      "type": "Microsoft.Authorization/roleAssignments",
      "name": "[guid(subscription().id, variables('seed'), variables('role_VmContributor'))]",
      "apiVersion": "2022-04-01",
      "properties": {
        "roleDefinitionId": "[variables('role_VmContributor')]",
        "principalId": "[reference(subscriptionResourceId('Microsoft.Automanage/servicePrincipals', 'default'), '2022-05-04', 'Full').properties.servicePrincipalId]"
      }
    },
    {
      "type": "Microsoft.Authorization/roleAssignments",
      "name": "[guid(subscription().id, variables('seed'), variables('role_arcMachineAdmin'))]",
      "apiVersion": "2022-04-01",
      "properties": {
        "roleDefinitionId": "[variables('role_arcMachineAdmin')]",
        "principalId": "[reference(subscriptionResourceId('Microsoft.Automanage/servicePrincipals', 'default'), '2022-05-04', 'Full').properties.servicePrincipalId]"
      }
    },
    {
      "type": "Microsoft.Authorization/roleAssignments",
      "name": "[guid(subscription().id, variables('seed'), variables('role_monitoringContributor'))]",
      "apiVersion": "2022-04-01",
      "properties": {
        "roleDefinitionId": "[variables('role_monitoringContributor')]",
        "principalId": "[reference(subscriptionResourceId('Microsoft.Automanage/servicePrincipals', 'default'), '2022-05-04', 'Full').properties.servicePrincipalId]"
      }
    },
    {
      "type": "Microsoft.Authorization/roleAssignments",
      "name": "[guid(subscription().id, variables('seed'), variables('role_wacAdmin'))]",
      "apiVersion": "2022-04-01",
      "properties": {
        "roleDefinitionId": "[variables('role_wacAdmin')]",
        "principalId": "[reference(subscriptionResourceId('Microsoft.Automanage/servicePrincipals', 'default'), '2022-05-04', 'Full').properties.servicePrincipalId]"
      }
    },
    {
      "type": "Microsoft.Authorization/roleAssignments",
      "name": "[guid(subscription().id, variables('seed'), variables('role_automationContributor'))]",
      "apiVersion": "2022-04-01",
      "properties": {
        "roleDefinitionId": "[variables('role_automationContributor')]",
        "principalId": "[reference(subscriptionResourceId('Microsoft.Automanage/servicePrincipals', 'default'), '2022-05-04', 'Full').properties.servicePrincipalId]"
      }
    },
    {
      "type": "Microsoft.Authorization/roleAssignments",
      "name": "[guid(subscription().id, variables('seed'), variables('role_policyContributor'))]",
      "apiVersion": "2022-04-01",
      "properties": {
        "roleDefinitionId": "[variables('role_policyContributor')]",
        "principalId": "[reference(subscriptionResourceId('Microsoft.Automanage/servicePrincipals', 'default'), '2022-05-04', 'Full').properties.servicePrincipalId]"
      }
    }
  ]
}
